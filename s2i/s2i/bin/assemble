#!/bin/bash -e

# If the 'springboot-centos7' assemble script is executed with the '-h' flag, print the usage.
#if [[ "$1" == "-h" ]]; then
#       exec /usr/libexec/s2i/usage
#fi


if [ "$1" = "-h" ]; then
    # If the 'springboot-sti' assemble script is executed with '-h' flag,
    # print the usage.
    exec /usr/local/sti/usage
fi


#echo "---> Installing application source..."
#cp -Rf /tmp/src/. ./


echo "---> Building application from source..."
# TODO: Add build steps for your application, eg npm install, bundle install, pip install, etc.

# Source code provided to STI is at ${HOME}/source
HOME=/opt/app-root/src
LOCAL_SOURCE_DIR=${HOME}/source

mkdir -p $LOCAL_SOURCE_DIR

DEPLOY_DIR=/opt/openshift

echo "Copying nginx config files..."

if [ $(ls /tmp/src/nginx.conf | wc -l) -eq 1 ]; then
  cp -ad /tmp/src/nginx.conf /etc/nginx/
  echo "Nginx config is deployed correctly."
else
  echo "Nginx config file does not exist!."
  exit 1
fi
